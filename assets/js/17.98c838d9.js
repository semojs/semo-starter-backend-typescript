(window.webpackJsonp=window.webpackJsonp||[]).push([[17],{363:function(t,s,e){"use strict";e.r(s);var a=e(43),r=Object(a.a)({},(function(){var t=this,s=t.$createElement,e=t._self._c||s;return e("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[e("h1",{attrs:{id:"helper-service"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#helper-service"}},[t._v("#")]),t._v(" Helper & Service")]),t._v(" "),e("p",[e("code",[t._v("Helper")]),t._v(" 建立在模型之上，根据业务进行划分，每个 Helper 可能同时读取多个数据表里的数据，在有一些框架里会称为 Repositery。"),e("code",[t._v("Service")]),t._v(" 是对远程服务的封装，或者说一切没在自己管理的数据库的资源都需要封装为 Service。")]),t._v(" "),e("p",[t._v("所有的 "),e("code",[t._v("Helper")]),t._v(" 和 "),e("code",[t._v("Service")]),t._v(" 都是通过 "),e("code",[t._v("typedi")]),t._v(" 提供的依赖注入的方式进行使用的，而不是 "),e("code",[t._v("import")]),t._v(" 之后直接使用。")]),t._v(" "),e("h2",{attrs:{id:"service"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#service"}},[t._v("#")]),t._v(" Service")]),t._v(" "),e("h3",{attrs:{id:"定义-service"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#定义-service"}},[t._v("#")]),t._v(" 定义 "),e("code",[t._v("Service")])]),t._v(" "),e("div",{staticClass:"language-js extra-class"},[e("pre",{pre:!0,attrs:{class:"language-js"}},[e("code",[e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" Service "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v("'typedi'")]),t._v("\n\n@"),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("Service")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("class")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("DemoService")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\n  "),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("/**\n   * DemoService->demoMethod\n   */")]),t._v("\n  "),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("demoMethod")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v("'This is a demo service'")]),t._v("\n  "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n"),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("export")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" DemoService\n")])])]),e("p",[t._v("注意到这里用了一个 "),e("code",[t._v("typedi")]),t._v(" 提供的装饰器： "),e("code",[t._v("@Service()")])]),t._v(" "),e("h3",{attrs:{id:"使用-service"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#使用-service"}},[t._v("#")]),t._v(" 使用 "),e("code",[t._v("Service")])]),t._v(" "),e("p",[t._v("我们可以在 Controller 里使用 Service，也可以在其他比如命令行工具，或者其他 Service 中使用。注意注入 "),e("code",[t._v("Service")]),t._v(" 用的是 "),e("code",[t._v("typedi")]),t._v(" 的 "),e("code",[t._v("@Inject()")]),t._v(" 装饰器。")]),t._v(" "),e("div",{staticClass:"language-js extra-class"},[e("pre",{pre:!0,attrs:{class:"language-js"}},[e("code",[e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" Inject "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v("'typedi'")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" DemoService "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v("'../service/DemoService'")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("...")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("export")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("class")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("DemoController")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("...")]),t._v("\n  @"),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("Inject")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n  demoService"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" DemoService\n  "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("...")]),t._v("\n  "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("async")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("index")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v("'Hi'")]),t._v("\n  "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),e("h2",{attrs:{id:"helper"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#helper"}},[t._v("#")]),t._v(" Helper")]),t._v(" "),e("h3",{attrs:{id:"定义-helper"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#定义-helper"}},[t._v("#")]),t._v(" 定义 Helper")]),t._v(" "),e("div",{staticClass:"language-js extra-class"},[e("pre",{pre:!0,attrs:{class:"language-js"}},[e("code",[e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" Service "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v("'typedi'")]),t._v("\n\n"),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" ModelInject "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v("'../decorator/DatabaseDecorator'")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" Project "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v("'../model/Project'")]),t._v("\n\n@"),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("Service")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("export")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("class")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("ProjectHelper")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  @"),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("ModelInject")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("Project"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n  project"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("typeof")]),t._v(" Project\n"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n")])])]),e("p",[t._v("可以看到这里也是用的 "),e("code",[t._v("typedi")]),t._v(" 实现思路完全一样。不一样的地方是我们为了定义操作数据库的方法，需要使用 "),e("code",[t._v("Sequelize")]),t._v(" 的数据模型，注意这里是如何注入的，用的是我们自定义的装饰器 "),e("code",[t._v("@ModelInject()")]),t._v("，同时为了类型提示，需要引入模型文件。")]),t._v(" "),e("div",{staticClass:"custom-block tip"},[e("p",{staticClass:"custom-block-title"},[t._v("TIP")]),t._v(" "),e("p",[t._v("定义装饰器是本脚手架的高级用法，具体可以看 "),e("code",[t._v("routing-controllers")]),t._v(" 和 "),e("code",[t._v("typedi")]),t._v(" 的文档看看，这里不做详细解释了。")])]),t._v(" "),e("h3",{attrs:{id:"使用-helper"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#使用-helper"}},[t._v("#")]),t._v(" 使用  Helper")]),t._v(" "),e("div",{staticClass:"language-js extra-class"},[e("pre",{pre:!0,attrs:{class:"language-js"}},[e("code",[e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("...")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" ProjectHelper "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v("'../helper/ProjectHelper'")]),t._v("\n\n"),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("export")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("class")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("ProjectController")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\n  "),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 注入一个 Helper，这里不推荐同时注入模型")]),t._v("\n  "),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 控制器只跟 Helper 和 Service 交互")]),t._v("\n  @"),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("Inject")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n  projectHelper"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" ProjectHelper\n"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("...")]),t._v("\n")])])]),e("p",[t._v("这里要注意注入 Helper 和给 Helper 注入数据模型实例稍微有一些不同，如果混用会很奇怪，建议所有的数据操作都调用 Helper。")])])}),[],!1,null,null,null);s.default=r.exports}}]);